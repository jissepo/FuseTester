<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FuseTester Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.0/index.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f5f5f5;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
        color: #333;
      }

      .controls {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
      }

      .control-group {
        display: flex;
        flex-direction: column;
      }

      .control-group label {
        font-weight: bold;
        margin-bottom: 5px;
        color: #555;
      }

      input,
      select,
      button {
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }

      button {
        background-color: #007bff;
        color: white;
        cursor: pointer;
        border: none;
        transition: background-color 0.3s;
      }

      button:hover {
        background-color: #0056b3;
      }

      button:disabled {
        background-color: #ccc;
        cursor: not-allowed;
      }

      .fuse-selector {
        max-height: 120px;
        overflow-y: auto;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 10px;
        background: #fafafa;
      }

      .fuse-checkbox {
        display: inline-block;
        margin: 2px 8px 2px 0;
      }

      .fuse-checkbox input {
        margin-right: 4px;
      }

      .chart-container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .stats-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .stat-card h3 {
        margin: 0 0 10px 0;
        color: #333;
      }

      .stat-card .value {
        font-size: 24px;
        font-weight: bold;
        color: #007bff;
      }

      .loading {
        text-align: center;
        padding: 40px;
        font-size: 18px;
        color: #666;
      }

      .error {
        background-color: #f8d7da;
        color: #721c24;
        padding: 15px;
        border-radius: 4px;
        margin: 10px 0;
      }

      .success {
        background-color: #d4edda;
        color: #155724;
        padding: 15px;
        border-radius: 4px;
        margin: 10px 0;
      }

      .quick-filters {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        margin-top: 10px;
      }

      .quick-filter {
        background-color: #e9ecef;
        border: 1px solid #ced4da;
        padding: 5px 10px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
        transition: background-color 0.3s;
      }

      .quick-filter:hover {
        background-color: #dee2e6;
      }

      .server-status {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: bold;
      }

      .server-status.online {
        background-color: #d4edda;
        color: #155724;
      }

      .server-status.offline {
        background-color: #f8d7da;
        color: #721c24;
      }

      .auto-refresh-info {
        font-size: 10px;
        color: #666;
        margin-top: 3px;
      }

      button.auto-refresh-active {
        background-color: #dc3545 !important;
      }

      button.auto-refresh-active:hover {
        background-color: #c82333 !important;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>FuseTester Dashboard</h1>
      <span id="serverStatus" class="server-status offline"
        >Server: Checking...</span
      >
    </div>

    <div class="controls">
      <div class="control-group">
        <label for="serverUrl">Server URL:</label>
        <input
          type="text"
          id="serverUrl"
          value=""
          placeholder="Server URL will be auto-detected"
        />
      </div>

      <div class="control-group">
        <label for="startDate">Start Date:</label>
        <input type="datetime-local" id="startDate" />
        <div class="quick-filters">
          <span class="quick-filter" onclick="setQuickFilter('1h')"
            >Last Hour</span
          >
          <span class="quick-filter" onclick="setQuickFilter('6h')"
            >Last 6 Hours</span
          >
          <span class="quick-filter" onclick="setQuickFilter('24h')"
            >Last 24 Hours</span
          >
          <span class="quick-filter" onclick="setQuickFilter('7d')"
            >Last 7 Days</span
          >
        </div>
      </div>

      <div class="control-group">
        <label for="endDate">End Date:</label>
        <input type="datetime-local" id="endDate" />
      </div>

      <div class="control-group">
        <label for="deviceId">Device ID (optional):</label>
        <input type="text" id="deviceId" placeholder="fusetester-001" />
      </div>

      <div class="control-group">
        <label for="fuseOffset">Fuse Number Offset:</label>
        <input
          type="number"
          id="fuseOffset"
          value="0"
          min="0"
          max="9999"
          placeholder="0"
          title="Add this offset to all displayed fuse numbers"
        />
        <small style="color: #666; font-size: 11px">
          Example: Offset 50 + Fuse 11 = Display "Fuse 61"
        </small>
      </div>

      <div class="control-group">
        <button onclick="loadData()" id="loadDataBtn">Load Data</button>
        <button onclick="checkServerHealth()" id="healthBtn">
          Check Server
        </button>
      </div>

      <div class="control-group">
        <button onclick="toggleAutoRefresh()" id="autoRefreshBtn">
          Enable Auto-Refresh
        </button>
        <small id="refreshStatus" style="margin-top: 5px; color: #666"
          >Auto-refresh: OFF</small
        >
      </div>
    </div>

    <div class="controls">
      <div class="control-group" style="grid-column: 1 / -1">
        <label>Select Fuses to Display:</label>
        <div class="fuse-selector" id="fuseSelector">
          <div style="margin-bottom: 10px">
            <button
              onclick="selectAllFuses()"
              style="margin-right: 10px; padding: 4px 8px; font-size: 12px"
            >
              Select All
            </button>
            <button
              onclick="selectNoFuses()"
              style="margin-right: 10px; padding: 4px 8px; font-size: 12px"
            >
              Select None
            </button>
            <button
              onclick="selectFuseRange(3, 6)"
              style="margin-right: 10px; padding: 4px 8px; font-size: 12px"
            >
              3-6
            </button>
            <button
              onclick="selectFuseRange(7, 10)"
              style="margin-right: 10px; padding: 4px 8px; font-size: 12px"
            >
              7-10
            </button>
            <button
              onclick="selectFuseRange(11, 14)"
              style="margin-right: 10px; padding: 4px 8px; font-size: 12px"
            >
              11-14
            </button>
            <button
              onclick="selectFuseRange(15, 18)"
              style="margin-right: 10px; padding: 4px 8px; font-size: 12px"
            >
              15-18
            </button>
            <button
              onclick="selectFuseRange(19, 22)"
              style="margin-right: 10px; padding: 4px 8px; font-size: 12px"
            >
              19-22
            </button>
            <button
              onclick="selectFuseRange(23, 26)"
              style="margin-right: 10px; padding: 4px 8px; font-size: 12px"
            >
              23-26
            </button>
            <button
              onclick="selectFuseRange(27, 30)"
              style="margin-right: 10px; padding: 4px 8px; font-size: 12px"
            >
              27-30
            </button>
            <button
              onclick="selectFuseRange(31, 34)"
              style="margin-right: 10px; padding: 4px 8px; font-size: 12px"
            >
              31-34
            </button>
            <button
              onclick="selectFuseRange(35, 38)"
              style="margin-right: 10px; padding: 4px 8px; font-size: 12px"
            >
              35-38
            </button>
            <button
              onclick="selectFuseRange(39, 42)"
              style="margin-right: 10px; padding: 4px 8px; font-size: 12px"
            >
              39 - 42
            </button>
            <button
              onclick="selectFuseRange(43, 46)"
              style="margin-right: 10px; padding: 4px 8px; font-size: 12px"
            >
              43 - 46
            </button>
          </div>
          <div id="fuseCheckboxes">
            <!-- Fuse checkboxes will be generated here -->
          </div>
        </div>
      </div>
    </div>

    <div class="stats-container" id="statsContainer" style="display: none">
      <div class="stat-card">
        <h3>Total Readings</h3>
        <div class="value" id="totalReadings">-</div>
      </div>
      <div class="stat-card">
        <h3>Current Battery</h3>
        <div class="value" id="currentBattery">- V</div>
      </div>
      <div class="stat-card">
        <h3>Time Range</h3>
        <div class="value" id="timeRange" style="font-size: 14px">-</div>
      </div>
    </div>

    <div class="chart-container">
      <canvas id="voltageChart" width="400" height="200"></canvas>
    </div>

    <div id="messages"></div>

    <script>
      let chart = null;
      let currentData = [];
      let autoRefreshInterval = null;
      let isAutoRefreshEnabled = false;
      let lastRefreshTime = null;

      // Voltage conversion function (raw value is 24.8125% of real value)
      function convertVoltage(rawVoltage) {
        if (rawVoltage === null || rawVoltage === undefined) return null;
        return rawVoltage / 0.248125; // Convert to real voltage
      }

      // Get fuse offset value
      function getFuseOffset() {
        const offsetInput = document.getElementById("fuseOffset");
        const offset = parseInt(offsetInput.value) || 0;
        return Math.max(0, offset); // Ensure positive number
      }

      // Format fuse display name with offset
      function formatFuseName(fuseNumber) {
        const offset = getFuseOffset();
        const displayNumber = fuseNumber + offset;
        return `Fuse ${displayNumber}`;
      }

      // Initialize the page
      document.addEventListener("DOMContentLoaded", function () {
        initializeFuseSelector();
        setDefaultDates();
        setDefaultServerUrl();
        checkServerHealth();

        // Add event listeners for fuse offset changes with debouncing
        const fuseOffsetInput = document.getElementById("fuseOffset");
        let offsetTimeout;

        fuseOffsetInput.addEventListener("input", function () {
          clearTimeout(offsetTimeout);
          offsetTimeout = setTimeout(updateFuseLabels, 300); // 300ms debounce
        });

        fuseOffsetInput.addEventListener("change", updateFuseLabels);
      });

      function initializeFuseSelector() {
        const container = document.getElementById("fuseCheckboxes");

        // Clear existing content
        container.innerHTML = "";

        // Add battery option first
        const batteryCheckbox = document.createElement("div");
        batteryCheckbox.className = "fuse-checkbox";
        batteryCheckbox.innerHTML = `
                    <input type="checkbox" id="battery" value="battery">
                    <label for="battery" style="font-weight: bold; color: #2196F3;">Battery</label>
                `;
        container.appendChild(batteryCheckbox);

        // Generate checkboxes for fuses 3-64 (excluding ground=1, battery=2)
        for (let i = 3; i <= 64; i++) {
          const checkbox = document.createElement("div");
          checkbox.className = "fuse-checkbox";
          const displayName = formatFuseName(i);
          checkbox.innerHTML = `
                    <input type="checkbox" id="fuse${i}" value="${i}">
                    <label for="fuse${i}">${displayName}</label>
                `;
          container.appendChild(checkbox);
        }

        // Select first 4 fuses by default (3-6)
        selectFuseRange(3, 6);
      }

      // Update fuse labels when offset changes
      function updateFuseLabels() {
        // Validate and normalize offset input
        const offsetInput = document.getElementById("fuseOffset");
        let offset = parseInt(offsetInput.value);

        // Ensure offset is a positive number
        if (isNaN(offset) || offset < 0) {
          offset = 0;
          offsetInput.value = 0;
        }

        // Update all fuse labels
        for (let i = 3; i <= 64; i++) {
          const label = document.querySelector(`label[for="fuse${i}"]`);
          if (label) {
            label.textContent = formatFuseName(i);
          }
        }

        // Update chart if data is loaded
        if (currentData.length > 0) {
          updateChart();
        }
      }

      function selectAllFuses() {
        const checkboxes = document.querySelectorAll(
          '#fuseCheckboxes input[type="checkbox"]'
        );
        checkboxes.forEach((cb) => (cb.checked = true));
      }

      function selectNoFuses() {
        const checkboxes = document.querySelectorAll(
          '#fuseCheckboxes input[type="checkbox"]'
        );
        checkboxes.forEach((cb) => (cb.checked = false));
      }

      function selectCommonFuses() {
        selectNoFuses();
        for (let i = 3; i <= 20; i++) {
          const checkbox = document.getElementById(`fuse${i}`);
          if (checkbox) checkbox.checked = true;
        }
      }
      function selectFuseRange(start = 3, end = 20) {
        selectNoFuses();
        for (let i = start; i <= end; i++) {
          const checkbox = document.getElementById(`fuse${i}`);
          if (checkbox) checkbox.checked = true;
        }
      }

      function setDefaultDates() {
        const now = new Date();
        const oneHourAgo = new Date(now.getTime() - 60 * 60 * 1000);

        document.getElementById("endDate").value = formatDateForInput(now);
        document.getElementById("startDate").value =
          formatDateForInput(oneHourAgo);
      }

      function formatDateForInput(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, "0");
        const day = String(date.getDate()).padStart(2, "0");
        const hours = String(date.getHours()).padStart(2, "0");
        const minutes = String(date.getMinutes()).padStart(2, "0");

        return `${year}-${month}-${day}T${hours}:${minutes}`;
      }

      function setDefaultServerUrl() {
        const serverUrlInput = document.getElementById("serverUrl");

        // If served from file:// protocol, use localhost:3000
        if (window.location.protocol === "file:") {
          serverUrlInput.value = "http://localhost:3000";
        } else {
          // Use the api subdomain of the current origin
          const protocol = window.location.protocol;
          const hostname = window.location.hostname;
          const port = window.location.port;

          // Create API subdomain URL
          const apiHostname = hostname.startsWith("api.")
            ? hostname
            : `api.${hostname}`;
          const portPart = port ? `:${port}` : "";

          serverUrlInput.value = `${protocol}//${apiHostname}${portPart}`;
        }
      }

      function setQuickFilter(period) {
        const now = new Date();
        const endDate = now;
        let startDate;

        switch (period) {
          case "1h":
            startDate = new Date(now.getTime() - 60 * 60 * 1000);
            break;
          case "6h":
            startDate = new Date(now.getTime() - 6 * 60 * 60 * 1000);
            break;
          case "24h":
            startDate = new Date(now.getTime() - 24 * 60 * 60 * 1000);
            break;
          case "7d":
            startDate = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
            break;
          default:
            return;
        }

        document.getElementById("startDate").value =
          formatDateForInput(startDate);
        document.getElementById("endDate").value = formatDateForInput(endDate);
      }

      function toggleAutoRefresh() {
        const btn = document.getElementById("autoRefreshBtn");
        const status = document.getElementById("refreshStatus");

        if (isAutoRefreshEnabled) {
          // Disable auto-refresh
          clearInterval(autoRefreshInterval);
          autoRefreshInterval = null;
          isAutoRefreshEnabled = false;
          btn.textContent = "Enable Auto-Refresh";
          btn.style.backgroundColor = "#007bff";
          status.textContent = "Auto-refresh: OFF";
          status.style.color = "#666";
        } else {
          // Enable auto-refresh
          isAutoRefreshEnabled = true;
          btn.textContent = "Disable Auto-Refresh";
          btn.style.backgroundColor = "#dc3545";
          status.textContent = "Auto-refresh: ON (every 5s)";
          status.style.color = "#28a745";

          // Start the refresh interval
          autoRefreshInterval = setInterval(autoRefreshData, 5000);

          // Do an immediate refresh
          autoRefreshData();
        }
      }

      async function autoRefreshData() {
        // Only refresh if we're not already loading data manually
        const loadBtn = document.getElementById("loadDataBtn");
        if (loadBtn.disabled) {
          return;
        }

        try {
          // Update end date to current time for real-time data
          const now = new Date();
          document.getElementById("endDate").value = formatDateForInput(now);

          // If this is a short time range, also update start date to maintain window
          const startDate = new Date(
            document.getElementById("startDate").value
          );
          const timeDiff = now - startDate;

          // For periods less than 1 hour, maintain a sliding window
          if (timeDiff <= 60 * 60 * 1000) {
            const windowSize = timeDiff;
            const newStartDate = new Date(now.getTime() - windowSize);
            document.getElementById("startDate").value =
              formatDateForInput(newStartDate);
          }

          // Load data silently (without showing loading messages)
          await loadDataSilently();

          lastRefreshTime = now;
          updateRefreshStatus();
        } catch (error) {
          console.log("Auto-refresh error:", error);
          // Don't show error messages for auto-refresh failures
        }
      }

      async function loadDataSilently() {
        const serverUrl = document.getElementById("serverUrl").value;
        const startDate = document.getElementById("startDate").value;
        const endDate = document.getElementById("endDate").value;
        const deviceId = document.getElementById("deviceId").value;

        // Build query parameters
        const params = new URLSearchParams();
        if (startDate) {
          // Treat datetime-local input as already in the intended timezone
          // Append 'Z' to treat it as UTC (what user actually means)
          const startISO = startDate + ":00.000Z";
          params.append("start", startISO);
        }
        if (endDate) {
          const endISO = endDate + ":00.000Z";
          params.append("end", endISO);
        }
        if (deviceId) params.append("device_id", deviceId);

        const response = await fetch(`${serverUrl}/data?${params}`);

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }

        const result = await response.json();

        if (result.success) {
          currentData = result.data;
          updateChart();
          updateStats(result);
        } else {
          throw new Error(result.error || "Unknown error");
        }
      }

      function updateRefreshStatus() {
        const status = document.getElementById("refreshStatus");
        if (isAutoRefreshEnabled && lastRefreshTime) {
          const timeAgo = Math.round((new Date() - lastRefreshTime) / 1000);
          status.textContent = `Auto-refresh: ON (last: ${timeAgo}s ago)`;
        }
      }

      // Update refresh status display every second
      setInterval(updateRefreshStatus, 1000);

      async function checkServerHealth() {
        const serverUrl = document.getElementById("serverUrl").value;
        const statusElement = document.getElementById("serverStatus");
        const healthBtn = document.getElementById("healthBtn");

        healthBtn.disabled = true;
        statusElement.textContent = "Server: Checking...";
        statusElement.className = "server-status offline";

        try {
          const response = await fetch(`${serverUrl}/health`);

          if (response.ok) {
            const data = await response.json();
            statusElement.textContent = "Server: Online";
            statusElement.className = "server-status online";
            showMessage(`Server is online: ${data.server}`, "success");
          } else {
            throw new Error(`HTTP ${response.status}`);
          }
        } catch (error) {
          statusElement.textContent = "Server: Offline";
          statusElement.className = "server-status offline";
          showMessage(`Server connection failed: ${error.message}`, "error");
        } finally {
          healthBtn.disabled = false;
        }
      }

      async function loadData() {
        const serverUrl = document.getElementById("serverUrl").value;
        const startDate = document.getElementById("startDate").value;
        const endDate = document.getElementById("endDate").value;
        const deviceId = document.getElementById("deviceId").value;
        const loadBtn = document.getElementById("loadDataBtn");

        loadBtn.disabled = true;
        loadBtn.textContent = "Loading...";
        showMessage("Loading data from server...", "info");

        try {
          // Build query parameters
          const params = new URLSearchParams();
          if (startDate) {
            const startISO = startDate + ":00.000Z";
            params.append("start", startISO);
          }
          if (endDate) {
            const endISO = endDate + ":00.000Z";
            params.append("end", endISO);
          }
          if (deviceId) params.append("device_id", deviceId);

          const response = await fetch(`${serverUrl}/data?${params}`);

          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }

          const result = await response.json();

          if (result.success) {
            currentData = result.data;
            updateChart();
            updateStats(result);
            showMessage(
              `Loaded ${result.count} readings successfully`,
              "success"
            );
          } else {
            throw new Error(result.error || "Unknown error");
          }
        } catch (error) {
          showMessage(`Failed to load data: ${error.message}`, "error");
          console.error("Load data error:", error);
        } finally {
          loadBtn.disabled = false;
          loadBtn.textContent = "Load Data";
        }
      }

      // Clean up auto-refresh on page unload
      window.addEventListener("beforeunload", function () {
        if (autoRefreshInterval) {
          clearInterval(autoRefreshInterval);
        }
      });

      function updateChart() {
        if (currentData.length === 0) {
          showMessage("No data to display", "error");
          return;
        }

        // Get selected items (fuses and/or battery)
        const selectedItems = [];
        const checkboxes = document.querySelectorAll(
          '#fuseCheckboxes input[type="checkbox"]:checked'
        );
        checkboxes.forEach((cb) => {
          if (cb.value === "battery") {
            selectedItems.push("battery");
          } else {
            selectedItems.push(parseInt(cb.value));
          }
        });

        if (selectedItems.length === 0) {
          showMessage("Please select at least one item to display", "error");
          return;
        }

        // Prepare chart data
        const labels = currentData.map((reading) => {
          // Since we now send timestamps as UTC matching user intent,
          // display them as UTC time (no timezone conversion)
          const date = new Date(reading.timestamp);
          return date.toISOString().slice(0, 19).replace("T", " "); // Format: "2025-08-11 16:19:42"
        });
        const datasets = [];

        // Generate colors for each item
        const colors = generateColors(selectedItems.length);

        selectedItems.forEach((item, index) => {
          let data, label;

          if (item === "battery") {
            // Battery data with voltage conversion
            data = currentData.map((reading) => {
              const rawVoltage = reading.battery_voltage;
              return convertVoltage(rawVoltage);
            });
            label = "Battery";
          } else {
            // Fuse data with voltage conversion
            data = currentData.map((reading) => {
              const rawVoltage = reading.fuse_readings[item];
              return rawVoltage !== null ? convertVoltage(rawVoltage) : null;
            });
            label = formatFuseName(item);
          }

          datasets.push({
            label: label,
            data: data,
            borderColor: colors[index],
            backgroundColor: colors[index] + "20",
            fill: false,
            tension: 0.1,
            pointRadius: 2,
            pointHoverRadius: 4,
          });
        });

        // Destroy existing chart
        if (chart) {
          chart.destroy();
        }

        // Create new chart
        const ctx = document.getElementById("voltageChart").getContext("2d");
        chart = new Chart(ctx, {
          type: "line",
          data: {
            labels: labels,
            datasets: datasets,
          },
          options: {
            responsive: true,
            plugins: {
              title: {
                display: true,
                text: "Fuse Voltage Readings Over Time",
              },
              legend: {
                display: true,
                position: "top",
              },
            },
            scales: {
              x: {
                display: true,
                title: {
                  display: true,
                  text: "Time",
                },
              },
              y: {
                display: true,
                title: {
                  display: true,
                  text: "Voltage (V)",
                },
                beginAtZero: false,
              },
            },
            interaction: {
              mode: "index",
              intersect: false,
            },
          },
        });
      }

      function updateStats(result) {
        const statsContainer = document.getElementById("statsContainer");

        document.getElementById("totalReadings").textContent = result.count;

        // Get current (latest) battery voltage and convert to real voltage
        const currentBatteryRaw = result.data[0]?.battery_voltage;
        const currentBattery =
          currentBatteryRaw !== null
            ? convertVoltage(currentBatteryRaw).toFixed(2)
            : "N/A";
        document.getElementById("currentBattery").textContent =
          currentBattery + " V";

        // Time range
        if (result.data.length > 0) {
          const earliest = new Date(
            result.data[result.data.length - 1].timestamp
          );
          const latest = new Date(result.data[0].timestamp);
          const duration = Math.round((latest - earliest) / (1000 * 60)); // minutes
          document.getElementById("timeRange").textContent = `${duration} min`;
        }

        statsContainer.style.display = "grid";
      }

      function generateColors(count) {
        const colors = [
          "#FF6384",
          "#36A2EB",
          "#FFCE56",
          "#4BC0C0",
          "#9966FF",
          "#FF9F40",
          "#FF6384",
          "#C9CBCF",
          "#4BC0C0",
          "#FF6384",
          "#36A2EB",
          "#FFCE56",
          "#4BC0C0",
          "#9966FF",
          "#FF9F40",
          "#FF6384",
          "#C9CBCF",
          "#4BC0C0",
          "#FF6384",
          "#36A2EB",
        ];

        const result = [];
        for (let i = 0; i < count; i++) {
          result.push(colors[i % colors.length]);
        }
        return result;
      }

      function showMessage(message, type = "info") {
        const messagesDiv = document.getElementById("messages");
        const messageDiv = document.createElement("div");
        messageDiv.className = type;
        messageDiv.textContent = message;

        messagesDiv.appendChild(messageDiv);

        // Remove message after 5 seconds
        setTimeout(() => {
          if (messageDiv.parentNode) {
            messageDiv.parentNode.removeChild(messageDiv);
          }
        }, 5000);
      }
    </script>
  </body>
</html>
